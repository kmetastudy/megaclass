{% extends 'points/teacher/base.html' %}

{% block title %}ν¬μΈνΈ λ¶€μ—¬/μ°¨κ° - ν¬μΈνΈ κ΄€λ¦¬ μ‹μ¤ν…{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" type="text/css">
{% endblock %}

{% block page_content %}
<!-- Toast Container -->
<div id="toaster" class="toaster"></div>

<div class="max-w-7xl mx-auto">
  <!-- νμ΄μ§€ ν—¤λ” -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">ν¬μΈνΈ λ¶€μ—¬/μ°¨κ°</h1>
    <p class="mt-2 text-gray-600">ν•™μƒλ“¤μ ν¬μΈνΈλ¥Ό κ΄€λ¦¬ν•μ„Έμ”</p>
  </div>

  <!-- μ•΅μ… λ²„νΌ μμ—­ -->
  <div class="flex justify-end mb-4">
    <button class="btn" id="manage-points-btn" disabled>
      <i data-lucide="plus-circle"></i>
      ν¬μΈνΈ λ¶€μ—¬/μ°¨κ°
    </button>
  </div>

  <!-- ν•™μƒ λ©λ΅ ν…μ΄λΈ” -->
  <div class="bg-white rounded-lg shadow p-6">
    <table id="students-table"></table>
  </div>
</div>

<!-- ν¬μΈνΈ λ¶€μ—¬/μ°¨κ° Dialog -->
<dialog
  id="manage-points-dialog"
  class="dialog"
  aria-labelledby="manage-points-title"
  onclick="if (event.target === this) this.close()"
>
  <article>
    <header>
      <h2 id="manage-points-title">ν¬μΈνΈ λ¶€μ—¬/μ°¨κ°</h2>
      <p class="text-sm text-gray-600">μ„ νƒν• <span id="selected-student-count">0</span>λ…μ ν•™μƒμ—κ² ν¬μΈνΈλ¥Ό μ²λ¦¬ν•©λ‹λ‹¤.</p>
    </header>
    <section>
      <form id="manage-points-form" class="space-y-4">
        <!-- ν¬μΈνΈ μ •μ±… μ„ νƒ -->
        <div>
          <label
            for="policy-select"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            ν¬μΈνΈ μ •μ±… <span class="text-red-500">*</span>
          </label>
          <select
            id="policy-select"
            name="policy_id"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="">μ •μ±…μ„ μ„ νƒν•μ„Έμ”</option>
            {% for policy in policies %}
            <option
              value="{{ policy.id }}"
              data-point-value="{{ policy.default_point_value }}"
            >
              {{ policy.name }} ({{ policy.default_point_value|stringformat:"+d" }}P)
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- ν¬μΈνΈ κ°’ -->
        <div>
          <label
            for="point-value-input"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            ν¬μΈνΈ κ°’ <span class="text-red-500">*</span>
          </label>
          <input
            type="number"
            id="point-value-input"
            name="point_value"
            required
            placeholder="μ •μ±…μ„ μ„ νƒν•λ©΄ μλ™μΌλ΅ μ…λ ¥λ©λ‹λ‹¤"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <p class="text-xs text-gray-500 mt-1">π’΅ μ–‘μλ” λ¶€μ—¬, μμλ” μ°¨κ°</p>
        </div>

        <!-- μ‚¬μ  -->
        <div>
          <label
            for="reason-input"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            μ‚¬μ  (μ„ νƒ)
          </label>
          <textarea
            id="reason-input"
            name="reason"
            rows="3"
            placeholder="ν¬μΈνΈ λ¶€μ—¬/μ°¨κ° μ‚¬μ λ¥Ό μ…λ ¥ν•μ„Έμ” (μ: μ¶μ„ μ²΄ν¬, μ™μ  λ―Έμ μ¶)"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>

        <!-- ν•™μƒ ID μ €μ¥ (hidden) -->
        <input type="hidden" id="selected-student-ids" name="student_ids" />
      </form>
    </section>
    <footer class="flex gap-2">
      <button
        type="button"
        class="btn-outline flex-1"
        onclick="this.closest('dialog').close()"
      >
        μ·¨μ†
      </button>
      <button
        type="button"
        id="save-points-btn"
        class="btn-primary flex-1"
        disabled
      >
        μ €μ¥
      </button>
    </footer>
  </article>
</dialog>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" type="text/javascript"></script>
{% include 'points/scripts/teacher/point_management_script.html' %}
{% endblock %}
