{% extends 'points/teacher/base.html' %} {% block title %}μ •μ±… κ΄€λ¦¬ - ν¬μΈνΈ
κ΄€λ¦¬ μ‹μ¤ν…{% endblock %} {% block page_content %}
<!-- Toast Container -->
<div id="toaster" class="toaster"></div>
{% csrf_token %}

<div class="max-w-7xl mx-auto">
  <!-- νμ΄μ§€ ν—¤λ” -->
  <div class="mb-8 flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">μ •μ±… κ΄€λ¦¬</h1>
      <p class="mt-2 text-gray-600">ν¬μΈνΈ μ •μ±…μ„ μƒμ„±ν•κ³  κ΄€λ¦¬ν•μ„Έμ”.</p>
    </div>
    <button
      type="button"
      class="btn-primary"
      data-action="open-create-dialog"
    >
      <i data-lucide="plus" class="w-4 h-4"></i>
      <span>μƒ μ •μ±… μ¶”κ°€</span>
    </button>
  </div>

  <!-- μ •μ±… μΉ΄λ“ κ·Έλ¦¬λ“ -->
  <div class="policy-card-container grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for policy in policies %}
    <div class="card"
         data-policy-id="{{ policy.id }}"
         data-policy-name="{{ policy.name }}"
         data-policy-value="{{ policy.default_point_value }}"
         data-policy-description="{{ policy.description|default:"" }}"
         data-policy-active="{{ policy.is_active|lower }}">
      <header>
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold">{{ policy.name }}</h3>
          {% if policy.is_active %}
          <span class="badge badge-primary">ν™μ„±</span>
          {% else %}
          <span class="badge badge-secondary">λΉ„ν™μ„±</span>
          {% endif %}
        </div>
      </header>
      <section>
        <div class="mb-4">
          <p class="text-3xl font-bold text-gray-900">
            {% if policy.default_point_value > 0 %}
            <span class="text-emerald-600"
              >+{{ policy.default_point_value }}P</span
            >
            {% elif policy.default_point_value < 0 %}
            <span class="text-red-600">{{ policy.default_point_value }}P</span>
            {% else %}
            <span class="text-gray-600">{{ policy.default_point_value }}P</span>
            {% endif %}
          </p>
        </div>
        <p class="text-sm text-gray-600">
          {{ policy.description|default:"μ„¤λ… μ—†μ" }}
        </p>
      </section>
      <footer class="flex gap-2">
        <button
          type="button"
          class="btn-outline flex-1"
          data-action="edit-policy"
          data-policy-id="{{ policy.id }}"
        >
          <i data-lucide="edit" class="w-4 h-4"></i>
          <span>μμ •</span>
        </button>
        <button
          type="button"
          class="btn-destructive flex-1"
          data-action="delete-policy"
          data-policy-id="{{ policy.id }}"
          data-policy-name="{{ policy.name|escapejs }}"
        >
          <i data-lucide="trash-2" class="w-4 h-4"></i>
          <span>μ‚­μ </span>
        </button>
      </footer>
    </div>
    {% empty %}
    <div class="col-span-full text-center py-12">
      <i data-lucide="inbox" class="w-16 h-16 mx-auto mb-4 text-gray-400"></i>
      <p class="text-gray-500 text-lg">μ•„μ§ μ •μ±…μ΄ μ—†μµλ‹λ‹¤</p>
      <p class="text-gray-400 text-sm mt-2">μƒ μ •μ±…μ„ μ¶”κ°€ν•μ—¬ μ‹μ‘ν•μ„Έμ”.</p>
    </div>
    {% endfor %}
  </div>
</div>

<!-- μ •μ±… μƒμ„± Dialog -->
<dialog
  id="create-policy-dialog"
  class="dialog"
  aria-labelledby="create-dialog-title"
  onclick="if (event.target === this) this.close()"
>
  <article>
    <header>
      <h2 id="create-dialog-title">μƒ μ •μ±… μ¶”κ°€</h2>
      <p class="text-sm text-gray-600">ν¬μΈνΈ μ •μ±… μ •λ³΄λ¥Ό μ…λ ¥ν•μ„Έμ”.</p>
    </header>
    <section>
      <form id="create-policy-form" class="space-y-4">
        <!-- ν™λ™λ… -->
        <div>
          <label
            for="create-name"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            ν™λ™λ… <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="create-name"
            name="name"
            required
            placeholder="μ: μ¶μ„ μ²΄ν¬, μ™μ  μ μ¶"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <!-- ν¬μΈνΈ κ°’ -->
        <div>
          <label
            for="create-point-value"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            ν¬μΈνΈ κ°’ <span class="text-red-500">*</span>
          </label>
          <input
            type="number"
            id="create-point-value"
            name="default_point_value"
            required
            placeholder="μ–‘μλ” μ λ¦½, μμλ” μ°¨κ°"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <p class="text-xs text-gray-500 mt-1">π’΅ μ–‘μλ” μ λ¦½, μμλ” μ°¨κ°</p>
        </div>

        <!-- μ„¤λ… -->
        <div>
          <label
            for="create-description"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            μ„¤λ… (μ„ νƒ)
          </label>
          <textarea
            id="create-description"
            name="description"
            rows="3"
            placeholder="μ •μ±…μ— λ€ν• μƒμ„Έ μ„¤λ…μ„ μ…λ ¥ν•μ„Έμ”"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>

        <!-- ν™μ„±ν™” μ—¬λ¶€ -->
        <div class="flex items-center gap-2">
          <input
            type="checkbox"
            id="create-is-active"
            name="is_active"
            checked
            class="w-4 h-4"
          />
          <label for="create-is-active" class="text-sm text-gray-700">
            μ΄ μ •μ±…μ„ ν™μ„±ν™”ν•©λ‹λ‹¤
          </label>
        </div>
      </form>
    </section>
    <footer class="flex gap-2">
      <button
        type="button"
        class="btn-outline flex-1"
        onclick="this.closest('dialog').close()"
      >
        μ·¨μ†
      </button>
      <button
        type="button"
        class="btn-primary flex-1"
        data-action="save-create"
      >
        μ €μ¥
      </button>
    </footer>
  </article>
</dialog>

<!-- μ •μ±… μμ • Dialog -->
<dialog
  id="edit-policy-dialog"
  class="dialog"
  aria-labelledby="edit-dialog-title"
  onclick="if (event.target === this) this.close()"
>
  <article>
    <header>
      <h2 id="edit-dialog-title">μ •μ±… μμ •</h2>
      <p class="text-sm text-gray-600">ν¬μΈνΈ μ •μ±… μ •λ³΄λ¥Ό μμ •ν•μ„Έμ”.</p>
    </header>
    <section>
      <form id="edit-policy-form" class="space-y-4">
        <input type="hidden" id="edit-policy-id" name="policy_id" />

        <!-- ν™λ™λ… -->
        <div>
          <label
            for="edit-name"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            ν™λ™λ… <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="edit-name"
            name="name"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <!-- ν¬μΈνΈ κ°’ -->
        <div>
          <label
            for="edit-point-value"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            ν¬μΈνΈ κ°’ <span class="text-red-500">*</span>
          </label>
          <input
            type="number"
            id="edit-point-value"
            name="default_point_value"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <p class="text-xs text-gray-500 mt-1">π’΅ μ–‘μλ” μ λ¦½, μμλ” μ°¨κ°</p>
        </div>

        <!-- μ„¤λ… -->
        <div>
          <label
            for="edit-description"
            class="block text-sm font-medium text-gray-700 mb-1"
          >
            μ„¤λ… (μ„ νƒ)
          </label>
          <textarea
            id="edit-description"
            name="description"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>

        <!-- ν™μ„±ν™” μ—¬λ¶€ -->
        <div class="flex items-center gap-2">
          <input
            type="checkbox"
            id="edit-is-active"
            name="is_active"
            class="w-4 h-4"
          />
          <label for="edit-is-active" class="text-sm text-gray-700">
            μ΄ μ •μ±…μ„ ν™μ„±ν™”ν•©λ‹λ‹¤
          </label>
        </div>
      </form>
    </section>
    <footer class="flex gap-2">
      <button
        type="button"
        class="btn-outline flex-1"
        onclick="this.closest('dialog').close()"
      >
        μ·¨μ†
      </button>
      <button
        type="button"
        class="btn-primary flex-1"
        data-action="save-edit"
      >
        μ €μ¥
      </button>
    </footer>
  </article>
</dialog>

<!-- μ •μ±… μ‚­μ  Alert Dialog -->
<dialog
  id="delete-policy-dialog"
  class="dialog"
  aria-labelledby="delete-dialog-title"
>
  <article>
    <header>
      <h2 id="delete-dialog-title" class="text-lg font-semibold text-red-600">
        μ •μ±… μ‚­μ  ν™•μΈ
      </h2>
    </header>
    <section>
      <input type="hidden" id="delete-policy-id" />
      <p id="delete-policy-message" class="text-gray-700"></p>
      <p class="text-sm text-gray-500 mt-2">
        μ΄ μ •μ±…κ³Ό κ΄€λ ¨λ κ±°λ λ‚΄μ—­μ€ μ μ§€λμ§€λ§, μ•μΌλ΅ μ΄ μ •μ±…μ„ μ‚¬μ©ν•  μ
        μ—†μµλ‹λ‹¤.
      </p>
    </section>
    <footer class="flex gap-2">
      <button
        type="button"
        class="btn-outline flex-1"
        onclick="this.closest('dialog').close()"
      >
        μ·¨μ†
      </button>
      <button
        type="button"
        class="btn-destructive flex-1"
        data-action="confirm-delete"
      >
        μ‚­μ 
      </button>
    </footer>
  </article>
</dialog>
{% endblock %}

{% block extra_js %}
<script type="module">
  import { initPolicyManagement } from '/static/js/pages/points/teacher/policy-management.js';

  document.addEventListener('DOMContentLoaded', () => {
    initPolicyManagement();
  });
</script>
{% endblock %}
